---
title: "Embed using corral"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Read in raw counts from MAE files

```{r}
library(here)
suppressPackageStartupMessages(library(MultiAssayExperiment))


mae_files <- list.files(
  path = here("data"),
  pattern = "MultiAssayExperiment.rds",
  recursive = TRUE,
  full.names = TRUE
)

names(mae_files) <- regmatches(mae_files, regexpr("PRJNA[0-9]+", mae_files))

# extract the data from the MAE files
mae_data <- parallel::mclapply(mae_files, 
  function(fpath) {
    mae <- readRDS(fpath)
    genes <- assay(mae, "gene counts")
    res <- assay(mae, "RE counts")
    genes.summed <- edgeR::sumTechReps(genes, ID = colData(mae)$BioSample)
    res.summed <- edgeR::sumTechReps(res, ID = colData(mae)$BioSample)
    return(list("Genes" = genes.summed, "REs" = res.summed))
    }, 
  mc.cores = 48
)

# extract count matrices
gene.mats <- lapply(mae_data, function(x) x[["Genes"]])
re.mats <- lapply(mae_data, function(x) x[["REs"]])
```

## Get non-zero features

```{r}
nonZero_genes <- Reduce(intersect, lapply(gene.mats, function(M) rownames(M[rowSums(M) > 0, ])))
nonZero_res <- Reduce(intersect, lapply(re.mats, function(M) rownames(M[rowSums(M) > 0, ])))
gene.filt <- lapply(gene.mats, function(M) M[nonZero_genes, ])
re.filt <- lapply(re.mats, function(M) M[nonZero_res, ])
```

## Scale the features by the library size

```{r}
gene.cpm <- lapply(gene.filt, function(M) {apply(M, 2, function(x) x / sum(x, na.rm = TRUE) * 1e6)})
re.cpm <- lapply(re.filt, function(M) {apply(M, 2, function(x) x / sum(x, na.rm = TRUE) * 1e6)})
```

## Correspondence Analysis on shared feature sets

```{r}
library(corral)


gene.ca <- corralm_matlist(
  matlist = gene.cpm,
  method = "irl",
  ncomp = 50,
  rtype = "hellinger"
)

re.ca <- corralm_matlist(
  matlist = re.cpm,
  method = "irl",
  ncomp = 30,
  rtype = "hellinger"
)
```

## Read in cleaned per-run metadata

```{r}
library(data.table)


metadata <- fread(here("doc/2021-10-15_metadata.tsv"))
drugs <- fread(here("doc/2021-10-15_drugs.tsv"))

# select only necessary columns
metadata <- unique(metadata[, .(BioSample, avgLength, LibrarySelection, 
                                LibraryLayout, Model, BioProject, title, 
                                SOURCE_INFO, CELL_INFO, TREATMENT_INFO, 
                                DOSE_INFO, TIME_INFO)])

metadata <- merge(metadata, drugs, by = "CELL_INFO", all.x = TRUE, all.y = FALSE)
head(metadata)
```

## Visualize the embedded data

```{r}
# get the per-sample embeddings
gene.ca_dt <- as.data.table(gene.ca$v, keep.rownames = "BioSample")
re.ca_dt <- as.data.table(re.ca$v, keep.rownames = "BioSample")

# join on the metadata information
gene.ca_dt <- merge(gene.ca_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
re.ca_dt <- merge(re.ca_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
```

plot

```{r message=FALSE, warning=FALSE}
source(here("src", "helpers", "helpers.R"))


# Color by BioProject
g_by_bioproject <- plot_dimReduction(gene.ca_dt, "V1", "V2", colBy = "BioProject", plot_title = "Gene Expression - CA by BioProject")
r_by_bioproject <- plot_dimReduction(re.ca_dt, "V1", "V2", colBy = "BioProject", plot_title = "RE Expression - CA by BioProject")
htmlwidgets::saveWidget(g_by_bioproject, file = here("results", "combined", "figures", "corral", "CA-gene-by-bioproject.html"))
htmlwidgets::saveWidget(r_by_bioproject, file = here("results", "combined", "figures", "corral", "CA-re-by-bioproject.html"))

# Color by disease
g_by_disease <- plot_dimReduction(gene.ca_dt, "V1", "V2", colBy = "DISEASE", plot_title = "Gene Expression - CA by Disease")
r_by_disease <- plot_dimReduction(re.ca_dt, "V1", "V2", colBy = "DISEASE", plot_title = "RE Expression - CA by Disease")
htmlwidgets::saveWidget(g_by_disease, file = here("results", "combined", "figures", "corral", "CA-gene-by-disease.html"))
htmlwidgets::saveWidget(r_by_disease, file = here("results", "combined", "figures", "corral", "CA-re-by-disease.html"))

# By Tissue
g_by_tissue <- plot_dimReduction(gene.ca_dt, "V1", "V2", colBy = "TISSUE", plot_title = "Gene Expression - CA by Tissue")
r_by_tissue <- plot_dimReduction(re.ca_dt, "V1", "V2", colBy = "TISSUE", plot_title = "RE Expression - CA by Tissue")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "CA-gene-by-tissue.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "CA-re-by-tissue.html"))

# By Cell Line
g_by_cell <- plot_dimReduction(gene.ca_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "Gene Expression - CA by Cell Line")
r_by_cell <- plot_dimReduction(re.ca_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "RE Expression - CA by Cell Line")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "CA-gene-by-cell.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "CA-re-by-cell.html"))
```

## tSNE on the CAs

```{r}
library(Rtsne)


g.tsne <- Rtsne(
  X = gene.ca$v,
  perplexity = 35,
  theta = 0.5,
  pca = FALSE,
  max_iter = 1e4,
  num_threads = 48
)

r.tsne <- Rtsne(
  X = re.ca$v,
  perplexity = 150,
  theta = 0.5,
  pca = FALSE,
  max_iter = 1e4,
  num_threads = 48
)
```

Join on metadata information

```{r}
# convert to data tables
g.tsne_dt <- as.data.table(g.tsne$Y)
r.tsne_dt <- as.data.table(r.tsne$Y)

# add sample names
g.tsne_dt[, BioSample := rownames(gene.ca$v)]
r.tsne_dt[, BioSample := rownames(re.ca$v)]

# join on metadata
g.tsne_dt <- merge(g.tsne_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
r.tsne_dt <- merge(r.tsne_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
```

Interactive tSNE plots

```{r message=FALSE, warning=FALSE}
# Color by BioProject
g_by_bioproject <- plot_dimReduction(g.tsne_dt, "V1", "V2", colBy = "BioProject", plot_title = "Gene Expression - TSNE by BioProject")
r_by_bioproject <- plot_dimReduction(r.tsne_dt, "V1", "V2", colBy = "BioProject", plot_title = "RE Expression - TSNE by BioProject")
htmlwidgets::saveWidget(g_by_bioproject, file = here("results", "combined", "figures", "corral", "TSNE-gene-by-bioproject.html"))
htmlwidgets::saveWidget(r_by_bioproject, file = here("results", "combined", "figures", "corral", "TSNE-re-by-bioproject.html"))

# Color by disease
g_by_disease <- plot_dimReduction(g.tsne_dt, "V1", "V2", colBy = "DISEASE", plot_title = "Gene Expression - TSNE by Disease")
r_by_disease <- plot_dimReduction(r.tsne_dt, "V1", "V2", colBy = "DISEASE", plot_title = "RE Expression - TSNE by Disease")
htmlwidgets::saveWidget(g_by_disease, file = here("results", "combined", "figures", "corral", "TSNE-gene-by-disease.html"))
htmlwidgets::saveWidget(r_by_disease, file = here("results", "combined", "figures", "corral", "TSNE-re-by-disease.html"))

# By Tissue
g_by_tissue <- plot_dimReduction(g.tsne_dt, "V1", "V2", colBy = "TISSUE", plot_title = "Gene Expression - TSNE by Tissue")
r_by_tissue <- plot_dimReduction(r.tsne_dt, "V1", "V2", colBy = "TISSUE", plot_title = "RE Expression - TSNE by Tissue")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-gene-by-tissue.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-re-by-tissue.html"))

# By Cell Line
g_by_cell <- plot_dimReduction(g.tsne_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "Gene Expression - TSNE by Cell Line")
r_by_cell <- plot_dimReduction(r.tsne_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "RE Expression - TSNE by Cell Line")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-gene-by-cell.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-re-by-cell.html"))
```

## Perform clustering on the samples/features

```{r eval=FALSE, include=FALSE}
gene.samples.clust <- hclust(dist(gene.ca$v), method = "average")
re.samples.clust <- hclust(dist(re.ca$v), method = "average")
gene.features.clust <- hclust(dist(gene.ca$u), method = "average")
re.features.clust <- hclust(dist(re.ca$u), method = "average")
```

## Plot dendrogram

```{r eval=FALSE, include=FALSE}
library(ggdendro)


# Perform clustering on CA distances
gene.samples.dendro <- as.dendrogram(gene.samples.clust)
re.samples.dendro <- as.dendrogram(re.samples.clust)

# Convert to dendro data
gene.samples.data <- dendro_data(gene.samples.dendro, type = "rectangle")
re.samples.data <- dendro_data(re.samples.dendro, type = "rectangle")

# Join metadata information onto dendro labels
gene.samples.data$labels <- merge(label(gene.samples.data), metadata, by.x = "label", by.y = "BioSample", all.x = TRUE, all.y = FALSE)
re.samples.data$labels <- merge(label(re.samples.data), metadata, by.x = "label", by.y = "BioSample", all.x = TRUE, all.y = FALSE)

# Create ggplot objects
ggplotly(
  ggplot(segment(gene.samples.data)) + 
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_text(data = label(gene.samples.data), aes(label = title, x = x, y = y, colour = BioProject)) +
  coord_flip() +
  theme_dendro()
)
```

## Leukemia Samples

```{r}
# Get leukemia samples
leukemias <- c("AML", "CML", "MCL", "ALL", "CLL", "MLL")
leukemia_samples <- unique(metadata[DISEASE %chin% leukemias, BioSample])
leukemia_projects <- unique(metadata[DISEASE %chin% leukemias, BioProject])
leukemia_projects <- leukemia_projects[leukemia_projects != "PRJNA556524"]

# Create matrices of leukemia samples only
leukemia.genes <- gene.cpm[leukemia_projects]
leukemia.res <- re.cpm[leukemia_projects]
```

CA on leukemia samples

```{r}
leukemia.gene.ca <- corralm_matlist(
  matlist = leukemia.genes,
  method = "irl",
  ncomp = 30,
  rtype = "hellinger"
)

leukemia.re.ca <- corralm_matlist(
  matlist = leukemia.res,
  method = "irl",
  ncomp = 30,
  rtype = "hellinger"
)

# get the per-sample embeddings
leukemia.gene.ca_dt <- as.data.table(leukemia.gene.ca$v, keep.rownames = "BioSample")
leukemia.re.ca_dt <- as.data.table(leukemia.re.ca$v, keep.rownames = "BioSample")

# join on the metadata information
leukemia.gene.ca_dt <- merge(leukemia.gene.ca_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
leukemia.re.ca_dt <- merge(leukemia.re.ca_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
```

plot

```{r}
# Color by BioProject
g_by_bioproject <- plot_dimReduction(leukemia.gene.ca_dt, "V1", "V2", colBy = "BioProject", plot_title = "Gene Expression - CA by BioProject")
r_by_bioproject <- plot_dimReduction(leukemia.re.ca_dt, "V1", "V2", colBy = "BioProject", plot_title = "RE Expression - CA by BioProject")
htmlwidgets::saveWidget(g_by_bioproject, file = here("results", "combined", "figures", "corral", "CA-leukemia-gene-by-bioproject.html"))
htmlwidgets::saveWidget(r_by_bioproject, file = here("results", "combined", "figures", "corral", "CA-leukemia-re-by-bioproject.html"))

# Color by disease
g_by_disease <- plot_dimReduction(leukemia.gene.ca_dt, "V1", "V2", colBy = "DISEASE", plot_title = "Gene Expression - CA by Disease")
r_by_disease <- plot_dimReduction(leukemia.re.ca_dt, "V1", "V2", colBy = "DISEASE", plot_title = "RE Expression - CA by Disease")
htmlwidgets::saveWidget(g_by_disease, file = here("results", "combined", "figures", "corral", "CA-leukemia-gene-by-disease.html"))
htmlwidgets::saveWidget(r_by_disease, file = here("results", "combined", "figures", "corral", "CA-leukemia-re-by-disease.html"))

# By Tissue
g_by_tissue <- plot_dimReduction(leukemia.gene.ca_dt, "V1", "V2", colBy = "TISSUE", plot_title = "Gene Expression - CA by Tissue")
r_by_tissue <- plot_dimReduction(leukemia.re.ca_dt, "V1", "V2", colBy = "TISSUE", plot_title = "RE Expression - CA by Tissue")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "CA-leukemia-gene-by-tissue.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "CA-leukemia-re-by-tissue.html"))

# By Cell Line
g_by_cell <- plot_dimReduction(leukemia.gene.ca_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "Gene Expression - CA by Cell Line")
r_by_cell <- plot_dimReduction(leukemia.re.ca_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "RE Expression - CA by Cell Line")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "CA-leukemia-gene-by-cell.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "CA-leukemia-re-by-cell.html"))
```

## tSNE on the CAs

```{r}
leukemia.g.tsne <- Rtsne(
  X = leukemia.gene.ca$v,
  perplexity = 35,
  theta = 0.5,
  pca = FALSE,
  max_iter = 1e4,
  num_threads = 24
)

leukemia.r.tsne <- Rtsne(
  X = leukemia.re.ca$v,
  perplexity = 150,
  theta = 0.5,
  pca = FALSE,
  max_iter = 1e4,
  num_threads = 24
)
```

Join on metadata information

```{r}
# convert to data tables
leukemia.g.tsne_dt <- as.data.table(leukemia.g.tsne$Y)
leukemia.r.tsne_dt <- as.data.table(leukemia.r.tsne$Y)

# add sample names
leukemia.g.tsne_dt[, BioSample := rownames(leukemia.gene.ca$v)]
leukemia.r.tsne_dt[, BioSample := rownames(leukemia.re.ca$v)]

# join on metadata
leukemia.g.tsne_dt <- merge(leukemia.g.tsne_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
leukemia.r.tsne_dt <- merge(leukemia.r.tsne_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
```

Interactive tSNE plots

```{r message=FALSE, warning=FALSE}
# Color by BioProject
g_by_bioproject <- plot_dimReduction(leukemia.g.tsne_dt, "V1", "V2", colBy = "BioProject", plot_title = "Gene Expression - TSNE by BioProject")
r_by_bioproject <- plot_dimReduction(leukemia.r.tsne_dt, "V1", "V2", colBy = "BioProject", plot_title = "RE Expression - TSNE by BioProject")
htmlwidgets::saveWidget(g_by_bioproject, file = here("results", "combined", "figures", "corral", "TSNE-leukemia-gene-by-bioproject.html"))
htmlwidgets::saveWidget(r_by_bioproject, file = here("results", "combined", "figures", "corral", "TSNE-leukemia-re-by-bioproject.html"))

# Color by disease
g_by_disease <- plot_dimReduction(leukemia.g.tsne_dt, "V1", "V2", colBy = "DISEASE", plot_title = "Gene Expression - TSNE by Disease")
r_by_disease <- plot_dimReduction(leukemia.r.tsne_dt, "V1", "V2", colBy = "DISEASE", plot_title = "RE Expression - TSNE by Disease")
htmlwidgets::saveWidget(g_by_disease, file = here("results", "combined", "figures", "corral", "TSNE-leukemia-gene-by-disease.html"))
htmlwidgets::saveWidget(r_by_disease, file = here("results", "combined", "figures", "corral", "TSNE-leukemia-re-by-disease.html"))

# By Tissue
g_by_tissue <- plot_dimReduction(leukemia.g.tsne_dt, "V1", "V2", colBy = "TISSUE", plot_title = "Gene Expression - TSNE by Tissue")
r_by_tissue <- plot_dimReduction(leukemia.r.tsne_dt, "V1", "V2", colBy = "TISSUE", plot_title = "RE Expression - TSNE by Tissue")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-leukemia-gene-by-tissue.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-leukemia-re-by-tissue.html"))

# By Cell Line
g_by_cell <- plot_dimReduction(leukemia.g.tsne_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "Gene Expression - TSNE by Cell Line")
r_by_cell <- plot_dimReduction(leukemia.r.tsne_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "RE Expression - TSNE by Cell Line")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-leukemia-gene-by-cell.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-leukemia-re-by-cell.html"))
```

## Colon Samples

```{r}
# Get colon samples
colon_samples <- unique(metadata[TISSUE == "Colon", BioSample])
colon_projects <- unique(metadata[TISSUE == "Colon", BioProject])

# Create matrices of colon samples only
colon.genes <- gene.cpm[colon_projects]
colon.res <- re.cpm[colon_projects]
```

CA on colon samples

```{r}
colon.gene.ca <- corralm_matlist(
  matlist = colon.genes,
  method = "irl",
  ncomp = 30,
  rtype = "hellinger"
)

colon.re.ca <- corralm_matlist(
  matlist = colon.res,
  method = "irl",
  ncomp = 30,
  rtype = "hellinger"
)

# get the per-sample embeddings
colon.gene.ca_dt <- as.data.table(colon.gene.ca$v, keep.rownames = "BioSample")
colon.re.ca_dt <- as.data.table(colon.re.ca$v, keep.rownames = "BioSample")

# join on the metadata information
colon.gene.ca_dt <- merge(colon.gene.ca_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
colon.re.ca_dt <- merge(colon.re.ca_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
```

plot

```{r}
# Color by BioProject
g_by_bioproject <- plot_dimReduction(colon.gene.ca_dt, "V1", "V2", colBy = "BioProject", plot_title = "Gene Expression - CA by BioProject")
r_by_bioproject <- plot_dimReduction(colon.re.ca_dt, "V1", "V2", colBy = "BioProject", plot_title = "RE Expression - CA by BioProject")
htmlwidgets::saveWidget(g_by_bioproject, file = here("results", "combined", "figures", "corral", "CA-colon-gene-by-bioproject.html"))
htmlwidgets::saveWidget(r_by_bioproject, file = here("results", "combined", "figures", "corral", "CA-colon-re-by-bioproject.html"))

# Color by disease
g_by_disease <- plot_dimReduction(colon.gene.ca_dt, "V1", "V2", colBy = "DISEASE", plot_title = "Gene Expression - CA by Disease")
r_by_disease <- plot_dimReduction(colon.re.ca_dt, "V1", "V2", colBy = "DISEASE", plot_title = "RE Expression - CA by Disease")
htmlwidgets::saveWidget(g_by_disease, file = here("results", "combined", "figures", "corral", "CA-colon-gene-by-disease.html"))
htmlwidgets::saveWidget(r_by_disease, file = here("results", "combined", "figures", "corral", "CA-colon-re-by-disease.html"))

# By Tissue
g_by_tissue <- plot_dimReduction(colon.gene.ca_dt, "V1", "V2", colBy = "TISSUE", plot_title = "Gene Expression - CA by Tissue")
r_by_tissue <- plot_dimReduction(colon.re.ca_dt, "V1", "V2", colBy = "TISSUE", plot_title = "RE Expression - CA by Tissue")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "CA-colon-gene-by-tissue.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "CA-colon-re-by-tissue.html"))

# By Cell Line
g_by_cell <- plot_dimReduction(colon.gene.ca_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "Gene Expression - CA by Cell Line")
r_by_cell <- plot_dimReduction(colon.re.ca_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "RE Expression - CA by Cell Line")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "CA-colon-gene-by-cell.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "CA-colon-re-by-cell.html"))
```

## tSNE on the CAs

```{r}
colon.g.tsne <- Rtsne(
  X = colon.gene.ca$v,
  perplexity = 35,
  theta = 0.5,
  pca = FALSE,
  max_iter = 1e4,
  num_threads = 24
)

colon.r.tsne <- Rtsne(
  X = colon.re.ca$v,
  perplexity = 30,
  theta = 0.5,
  pca = FALSE,
  max_iter = 1e4,
  num_threads = 24
)
```

Join on metadata information

```{r}
# convert to data tables
colon.g.tsne_dt <- as.data.table(colon.g.tsne$Y)
colon.r.tsne_dt <- as.data.table(colon.r.tsne$Y)

# add sample names
colon.g.tsne_dt[, BioSample := rownames(colon.gene.ca$v)]
colon.r.tsne_dt[, BioSample := rownames(colon.re.ca$v)]

# join on metadata
colon.g.tsne_dt <- merge(colon.g.tsne_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
colon.r.tsne_dt <- merge(colon.r.tsne_dt, metadata, by = "BioSample", all.x = TRUE, all.y = FALSE)
```

Interactive tSNE plots

```{r message=FALSE, warning=FALSE}
# Color by BioProject
g_by_bioproject <- plot_dimReduction(colon.g.tsne_dt, "V1", "V2", colBy = "BioProject", plot_title = "Gene Expression - TSNE by BioProject")
r_by_bioproject <- plot_dimReduction(colon.r.tsne_dt, "V1", "V2", colBy = "BioProject", plot_title = "RE Expression - TSNE by BioProject")
htmlwidgets::saveWidget(g_by_bioproject, file = here("results", "combined", "figures", "corral", "TSNE-colon-gene-by-bioproject.html"))
htmlwidgets::saveWidget(r_by_bioproject, file = here("results", "combined", "figures", "corral", "TSNE-colon-re-by-bioproject.html"))

# Color by disease
g_by_disease <- plot_dimReduction(colon.g.tsne_dt, "V1", "V2", colBy = "DISEASE", plot_title = "Gene Expression - TSNE by Disease")
r_by_disease <- plot_dimReduction(colon.r.tsne_dt, "V1", "V2", colBy = "DISEASE", plot_title = "RE Expression - TSNE by Disease")
htmlwidgets::saveWidget(g_by_disease, file = here("results", "combined", "figures", "corral", "TSNE-colon-gene-by-disease.html"))
htmlwidgets::saveWidget(r_by_disease, file = here("results", "combined", "figures", "corral", "TSNE-colon-re-by-disease.html"))

# By Tissue
g_by_tissue <- plot_dimReduction(colon.g.tsne_dt, "V1", "V2", colBy = "TISSUE", plot_title = "Gene Expression - TSNE by Tissue")
r_by_tissue <- plot_dimReduction(colon.r.tsne_dt, "V1", "V2", colBy = "TISSUE", plot_title = "RE Expression - TSNE by Tissue")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-colon-gene-by-tissue.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-colon-re-by-tissue.html"))

# By Cell Line
g_by_cell <- plot_dimReduction(colon.g.tsne_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "Gene Expression - TSNE by Cell Line")
r_by_cell <- plot_dimReduction(colon.r.tsne_dt, "V1", "V2", colBy = "CELL_INFO", plot_title = "RE Expression - TSNE by Cell Line")
htmlwidgets::saveWidget(g_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-colon-gene-by-cell.html"))
htmlwidgets::saveWidget(r_by_tissue, file = here("results", "combined", "figures", "corral", "TSNE-colon-re-by-cell.html"))
```


